<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>바둑 플러스 - 통계 대시보드</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">바둑 플러스 - 통계 대시보드</span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="chart-container">
                    <h3>월별 게임 통계</h3>
                    <div id="monthlyStats"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h3>플레이어 승률</h3>
                    <div id="playerStats"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 월별 게임 통계 차트
        fetch('/api/statistics')
            .then(response => response.json())
            .then(data => {
                const months = data.map(item => item.month);
                const totalGames = data.map(item => item.total_games);
                const avgBlackScore = data.map(item => item.avg_black_score);
                const avgWhiteScore = data.map(item => item.avg_white_score);

                const trace1 = {
                    x: months,
                    y: totalGames,
                    name: '총 게임 수',
                    type: 'bar'
                };

                const trace2 = {
                    x: months,
                    y: avgBlackScore,
                    name: '평균 흑돌 점수',
                    type: 'scatter'
                };

                const trace3 = {
                    x: months,
                    y: avgWhiteScore,
                    name: '평균 백돌 점수',
                    type: 'scatter'
                };

                const layout = {
                    title: '월별 게임 통계',
                    barmode: 'group'
                };

                Plotly.newPlot('monthlyStats', [trace1, trace2, trace3], layout);
            });

        // 플레이어 통계 차트
        fetch('/api/player-stats')
            .then(response => response.json())
            .then(data => {
                const players = data.map(item => item.player_name);
                const winRates = data.map(item => (item.wins / item.total_games * 100).toFixed(1));

                const trace = {
                    x: players,
                    y: winRates,
                    type: 'bar',
                    marker: {
                        color: 'rgb(55, 83, 109)'
                    }
                };

                const layout = {
                    title: '플레이어별 승률 (%)',
                    yaxis: {
                        title: '승률 (%)',
                        range: [0, 100]
                    }
                };

                Plotly.newPlot('playerStats', [trace], layout);
            });
    </script>
</body>
</html> 